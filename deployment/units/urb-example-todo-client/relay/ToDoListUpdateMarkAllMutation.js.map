{"version":3,"sources":["../../../../units/urb-example-todo-client/relay/ToDoListUpdateMarkAllMutation.js"],"names":["mutation","commit","environment","user","ToDos","ToDo_Complete","status","variables","input","updater","store","userProxy","get","id","connection","getConnection","ToDosEdges","getRootField","getLinkedRecord","getLinkedRecords","setLinkedRecords","optimisticUpdater","optimisticResponse","payload","Viewer","edges","changedToDos","filter","node","map","ToDo_TotalCount","ToDo_CompletedCount","ToDoListUpdateMarkAll"],"mappings":";;AAEA;AACA;;AAEA,GAAMA,uGAAN;;;;;;;;;;;;;;;;;;;;;;;;AAwBA,QAASC,OAAT,CAAgBC,WAAhB,CAA6BC,IAA7B,CAAmCC,KAAnC,CAA0CC,aAA1C,CAAyDC,MAAzD,CAAiE;AAC/D,MAAO,+BAAeJ,WAAf,CAA4B;AACjCF,iBADiC;AAEjCO,UAAW;AACTC,MAAO,CAAEH,2BAAF,CADE;AAETC,aAFS,CAFsB;;;AAOjCG,OAPiC,kBAOzBC,KAPyB,CAOlB;AACb,GAAMC,WAAYD,MAAME,GAAN,CAAUT,KAAKU,EAAf,CAAlB;AACA,GAAMC,YAAa,gCAAkBC,aAAlB,CAAgCJ,SAAhC,CAA2C,gBAA3C,CAA6D,CAAEL,aAAF,CAA7D,CAAnB;AACA,GAAMU,YAAaN;AAChBO,YADgB,CACH,uBADG;AAEhBC,eAFgB,CAEA,QAFA;AAGhBA,eAHgB,CAGA,OAHA,CAGS,CAAEZ,aAAF,CAHT;AAIhBa,gBAJgB,CAIC,OAJD,CAAnB;AAKAL,WAAWM,gBAAX,CAA4BJ,UAA5B,CAAwC,OAAxC;AACD,CAhBgC;;AAkBjCK,iBAlBiC,4BAkBfX,KAlBe,CAkBR;AACvB,GAAMC,WAAYD,MAAME,GAAN,CAAUT,KAAKU,EAAf,CAAlB;AACA,GAAMC,YAAa,gCAAkBC,aAAlB,CAAgCJ,SAAhC,CAA2C,gBAA3C,CAA6D,CAAEL,aAAF,CAA7D,CAAnB;;AAEA,GAAKD,eAAiBC,SAAW,QAA7B,EAA2C,CAACD,aAAD,EAAkBC,SAAW,WAA5E,CAA0F;AACxFQ,WAAWM,gBAAX,CAA4B,EAA5B,CAAgC,OAAhC;AACD;AACF,CAzBgC;;AA2BjCE,kBA3BiC,8BA2BZ;AACnB,GAAMC,SAAU;AACdC,OAAQ;AACNX,GAAIV,KAAKU,EADH,CADM,CAAhB;;;;AAMA,GAAIT,OAASA,MAAMqB,KAAnB,CAA0B;AACxBF,QAAQG,YAAR,CAAuBtB,MAAMqB,KAAN;AACpBE,MADoB,CACb,kBAAGC,KAAH,MAAGA,IAAH,OAAcA,MAAKvB,aAAL,GAAuBA,aAArC,EADa;AAEpBwB,GAFoB,CAEhB,mBAAGD,KAAH,OAAGA,IAAH,OAAe,CAAEf,GAAIe,KAAKf,EAAX,CAAeR,2BAAf,CAAf,EAFgB,CAAvB;AAGD;;AAED,GAAIA,aAAJ,CAAmB;AACjB,GAAIF,KAAK2B,eAAL,EAAwB,IAA5B,CAAkC;AAChCP,QAAQC,MAAR,CAAeO,mBAAf,CAAqC5B,KAAK2B,eAA1C;AACD;AACF,CAJD,IAIO;AACLP,QAAQC,MAAR,CAAeO,mBAAf,CAAqC,CAArC;AACD;;AAED,MAAO;AACLC,sBAAuBT,OADlB,CAAP;;AAGD,CAnDgC,CAA5B,CAAP;;AAqDD,C;;AAEc,CAAEtB,aAAF,C,oIAhFTD,Q,kHAwBGC,M","file":"ToDoListUpdateMarkAllMutation.js","sourcesContent":["// @flow weak\n\nimport { commitMutation, graphql } from 'react-relay'\nimport { ConnectionHandler } from 'relay-runtime'\n\nconst mutation = graphql`\n  mutation ToDoListUpdateMarkAllMutation($input: ToDoListUpdateMarkAllInput!, $status: String!) {\n    ToDoListUpdateMarkAll(input: $input) {\n      Viewer {\n        ToDos(status: $status) {\n          edges {\n            node {\n              id\n              ToDo_Complete\n              ToDo_Text\n            }\n          }\n        }\n        id\n        ToDo_CompletedCount\n      }\n      changedToDos {\n        id\n        ToDo_Complete\n      }\n    }\n  }\n`\n\nfunction commit(environment, user, ToDos, ToDo_Complete, status) {\n  return commitMutation(environment, {\n    mutation,\n    variables: {\n      input: { ToDo_Complete },\n      status,\n    },\n\n    updater(store) {\n      const userProxy = store.get(user.id)\n      const connection = ConnectionHandler.getConnection(userProxy, 'ToDoList_ToDos', { status })\n      const ToDosEdges = store\n        .getRootField('ToDoListUpdateMarkAll')\n        .getLinkedRecord('Viewer')\n        .getLinkedRecord('ToDos', { status })\n        .getLinkedRecords('edges')\n      connection.setLinkedRecords(ToDosEdges, 'edges')\n    },\n\n    optimisticUpdater(store) {\n      const userProxy = store.get(user.id)\n      const connection = ConnectionHandler.getConnection(userProxy, 'ToDoList_ToDos', { status })\n\n      if ((ToDo_Complete && status === 'active') || (!ToDo_Complete && status === 'completed')) {\n        connection.setLinkedRecords([], 'edges')\n      }\n    },\n\n    optimisticResponse() {\n      const payload = {\n        Viewer: {\n          id: user.id,\n        },\n      }\n\n      if (ToDos && ToDos.edges) {\n        payload.changedToDos = ToDos.edges\n          .filter(({ node }) => node.ToDo_Complete !== ToDo_Complete)\n          .map(({ node }) => ({ id: node.id, ToDo_Complete }))\n      }\n\n      if (ToDo_Complete) {\n        if (user.ToDo_TotalCount != null) {\n          payload.Viewer.ToDo_CompletedCount = user.ToDo_TotalCount\n        }\n      } else {\n        payload.Viewer.ToDo_CompletedCount = 0\n      }\n\n      return {\n        ToDoListUpdateMarkAll: payload,\n      }\n    },\n  })\n}\n\nexport default { commit }\n"]}