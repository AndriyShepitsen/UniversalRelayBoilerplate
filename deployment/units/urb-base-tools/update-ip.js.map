{"version":3,"sources":["../../../units/urb-base-tools/update-ip.js"],"names":["require","load","port","process","env","PORT","Error","IPAddress","argv","undefined","console","log","updateIPInFile","fileName","searchString","newContentOfLine","fileLines","readFileSync","split","index","length","indexOf","writeFileSync","join","err"],"mappings":";;AAEA,sB;;AAEA,+E;AACA,yD;;;AAGAA,QAAS,QAAT,EAAoBC,IAApB;;AAEA,GAAMC,MAAOC,QAAQC,GAAR,CAAYC,IAAzB;AACA,GAAKH,MAAQ,IAAR,EAAgB,MAAOA,KAAP,GAAgB,QAArC;AACE,KAAM,IAAII,MAAJ;AACJ,gEADI,CAAN;;;AAIF,GAAIC,WAAYJ,QAAQK,IAAR,CAAa,CAAb,CAAhB;;AAEA,GAAKD,YAAcE,SAAnB,CAA+BF,UAAY,0BAAZ;;AAE/B,GAAKA,YAAcE,SAAnB,CAA+B;AAC7BC,QAAQC,GAAR,CAAa,cAAgBJ,SAA7B;AACAK;AACE,mCAA6B,gBAD/B;AAEE,+CAFF;AAGE;AACEL,SADF;AAEE,iDALJ;AAMEA,SANF;;AAQAK;AACE,kDADF;AAEE,iBAFF;AAGE,8BAAgCL,SAAhC,CAA4C,GAA5C,CAAkDL,IAAlD,CAAyD,IAH3D;AAIEK,SAJF;;AAMAK;AACE,QADF;AAEE,aAFF;AAGE,qBAAuBL,SAAvB,CAAmC,GAAnC,CAAyCL,IAH3C;AAIEK,SAJF;;AAMAK,eAAgB,QAAhB,CAA0B,OAA1B,CAAmC,QAAUL,SAA7C,CAAwDA,SAAxD;AACD,CAvBD,IAuBOG,SAAQC,GAAR,CAAa,iDAAb;;AAEP,QAASC,eAAT,CAAyBC,QAAzB,CAAmCC,YAAnC,CAAiDC,gBAAjD,CAAmER,SAAnE,CAA+E;AAC7E,GAAI;AACF,GAAIS,WAAY,aAAGC,YAAH,CAAiBJ,QAAjB,CAA2B,MAA3B,EAAoCK,KAApC,CAA2C,IAA3C,CAAhB;AACA,GAAIC,OAAQ,CAAZ;;AAEA,MAAQA,MAAQH,UAAUI,MAA1B,CAAmC;AACjC,GAAKJ,UAAUG,KAAV,EAAiBE,OAAjB,CAA0BP,YAA1B,EAA2C,CAAC,CAAjD,CAAqD;AACnD,GAAKE,UAAUG,KAAV,IAAqBJ,gBAA1B;AACEL,QAAQC,GAAR,CAAa,IAAME,QAAN,CAAiB,yBAA9B,EADF;AAEK;AACHG,UAAUG,KAAV,EAAmBJ,gBAAnB;AACA,aAAGO,aAAH,CAAkBT,QAAlB,CAA4BG,UAAUO,IAAV,CAAgB,IAAhB,CAA5B;;AAEAb,QAAQC,GAAR;AACE,IAAME,QAAN,CAAiB,mCAAjB,CAAuDN,SADzD;;AAGD;AACD;AACD,CAZD,IAYO;AACLY;AACD;AACF;AACF,CAAC,MAAQK,GAAR,CAAc;AACdd,QAAQC,GAAR;AACE;AACEE,QADF;AAEE,oDAFF;AAGEW,GAJJ;;AAMD;AACF","file":"update-ip.js","sourcesContent":["// @flow\n\nimport fs from 'fs'\n\nimport AppRegistryName from '../_configuration/urb-base-app/AppRegistryName'\nimport getLocalIP from '../urb-base-server/getLocalIP'\n\n// Read environment\nrequire( 'dotenv' ).load()\n\nconst port = process.env.PORT\nif ( port == null || typeof port !== 'string' )\n  throw new Error(\n    'ðŸ’”  update-ip requires the environment variable PORT to be set'\n  )\n\nlet IPAddress = process.argv[2]\n\nif ( IPAddress === undefined ) IPAddress = getLocalIP()\n\nif ( IPAddress !== undefined ) {\n  console.log( 'IP Address:' + IPAddress )\n  updateIPInFile(\n    './ios/' + AppRegistryName + '/AppDelegate.m',\n    'jsCodeLocation = [NSURL URLWithString:@\"http:',\n    '  jsCodeLocation = [NSURL URLWithString:@\"http://' +\n      IPAddress +\n      ':8081/index.ios.bundle?platform=ios&dev=true\"];',\n    IPAddress\n  )\n  updateIPInFile(\n    './units/_configuration/urb-base-app/publicURL.js',\n    'const publicURL',\n    'const publicURL = \\'http://' + IPAddress + ':' + port + '\\'',\n    IPAddress\n  )\n  updateIPInFile(\n    './.env',\n    'PUBLIC_URL=',\n    'PUBLIC_URL=http://' + IPAddress + ':' + port,\n    IPAddress\n  )\n  updateIPInFile( './.env', 'HOST=', 'HOST=' + IPAddress, IPAddress )\n} else console.log( 'IP Address not specified and could not be found' )\n\nfunction updateIPInFile( fileName, searchString, newContentOfLine, IPAddress ) {\n  try {\n    let fileLines = fs.readFileSync( fileName, 'utf8' ).split( '\\n' )\n    let index = 0\n\n    while ( index < fileLines.length ) {\n      if ( fileLines[index].indexOf( searchString ) > -1 ) {\n        if ( fileLines[index] === newContentOfLine )\n          console.log( '[' + fileName + '] is already up to date' )\n        else {\n          fileLines[index] = newContentOfLine\n          fs.writeFileSync( fileName, fileLines.join( '\\n' ) )\n\n          console.log(\n            '[' + fileName + '] has been updated with local IP ' + IPAddress\n          )\n        }\n        break\n      } else {\n        index++\n      }\n    }\n  } catch ( err ) {\n    console.log(\n      '[' +\n        fileName +\n        '] has not been been updated with local IP because ' +\n        err\n    )\n  }\n}\n"]}