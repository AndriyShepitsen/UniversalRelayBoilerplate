{"version":3,"sources":["../../../../units/urb-base-webapp/scripts/ViewportDimensions.js"],"names":["SMALL","MEDIUM","LARGE","ViewportDimensions","removeComponent","handle_onResize","subscribedComponents","Map","viewportDimensionsVersion","viewportDimensions","muiSize","totalWidth","totalHeight","contentWidth","component","dimensionName","subscriptionInfo","get","set","self","componentWillUnmount","currentFunction","bind","dimensionValue","Error","delete","window","innerWidth","innerHeight","navDrawerIsDocked","changesMade","dimensionsSubscribed","mustUpdate","dimension","forceUpdate"],"mappings":"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","file":"ViewportDimensions.js","sourcesContent":["// @flow\n\nexport const SMALL = 1\nexport const MEDIUM = 2\nexport const LARGE = 3\n\nexport default class ViewportDimensions {\n  subscribedComponents: Map<Object, Object>\n  viewportDimensionsVersion: number\n  viewportDimensions: Object\n\n  constructor() {\n    this.subscribedComponents = new Map()\n\n    this.viewportDimensionsVersion = 1\n    this.viewportDimensions = {\n      muiSize: 0,\n      totalWidth: 0,\n      totalHeight: 0,\n      contentWidth: 0,\n    }\n  }\n\n  get(component: Object, dimensionName: string) {\n    // Mark that the component is being rendered with the current version\n    component.viewportDimensionsVersion = this.viewportDimensionsVersion\n\n    // Is the object subscribed? If not, it should be\n    let subscriptionInfo = this.subscribedComponents.get(component)\n    if (subscriptionInfo == null) {\n      // Add component to subscriptions dictionary\n      subscriptionInfo = {}\n      this.subscribedComponents.set(component, subscriptionInfo)\n\n      const self = this\n\n      // Make sure component unsubscribes when destroyed\n      if (component.componentWillUnmount) {\n        const currentFunction = component.componentWillUnmount.bind(component)\n\n        component.componentWillUnmount = () => {\n          self.removeComponent(component)\n          currentFunction()\n        }\n      } else\n        component.componentWillUnmount = () => {\n          self.removeComponent(component)\n        }\n    }\n\n    // Make sure it is subscribed for the right setting\n    subscriptionInfo[dimensionName] = true\n\n    // Now that the configuration is current, get the setting value\n    let dimensionValue = this.viewportDimensions[dimensionName]\n    if (dimensionValue == null)\n      throw new Error('Could not find viewport dimension named ' + dimensionName)\n\n    return dimensionValue\n  }\n\n  removeComponent = (component: Object) => {\n    this.subscribedComponents.delete(component)\n  }\n\n  handle_onResize = () => {\n    const totalWidth = window.innerWidth\n    const totalHeight = window.innerHeight\n\n    let muiSize\n    if (totalWidth >= 992) muiSize = LARGE\n    else if (totalWidth >= 768)\n      muiSize = MEDIUM // totalWidth < 768\n    else muiSize = SMALL\n\n    let navDrawerIsDocked = false\n    let contentWidth = totalWidth\n    if (muiSize === LARGE) {\n      navDrawerIsDocked = true\n      contentWidth -= 256 // TODO x0100 Make it a setting\n    }\n\n    // Record what changes were made to only notify the necessary components\n    const changesMade = {}\n\n    if (muiSize !== this.viewportDimensions.muiSize) {\n      changesMade.muiSize = true\n      this.viewportDimensions.muiSize = muiSize\n    }\n\n    if (totalWidth !== this.viewportDimensions.totalWidth) {\n      changesMade.totalWidth = true\n      this.viewportDimensions.totalWidth = totalWidth\n    }\n\n    if (totalHeight !== this.viewportDimensions.totalHeight) {\n      changesMade.totalHeight = true\n      this.viewportDimensions.totalHeight = totalHeight\n    }\n\n    if (contentWidth !== this.viewportDimensions.contentWidth) {\n      changesMade.contentWidth = true\n      this.viewportDimensions.contentWidth = contentWidth\n    }\n\n    const viewportDimensionsVersion = ++this.viewportDimensionsVersion\n\n    // Update all subscribed components\n    for (let [component, dimensionsSubscribed] of this.subscribedComponents) {\n      if (component.viewportDimensionsVersion != viewportDimensionsVersion) {\n        component.viewportDimensionsVersion = viewportDimensionsVersion\n\n        // Did the component subscribe to the changes that were actually made?\n        let mustUpdate = false\n        for (let dimension in dimensionsSubscribed)\n          if (changesMade[dimension]) {\n            mustUpdate = true\n            break\n          }\n\n        // Re-render component if it subscribed to any of the changes\n        if (mustUpdate) component.forceUpdate()\n      }\n    }\n  }\n}\n"]}